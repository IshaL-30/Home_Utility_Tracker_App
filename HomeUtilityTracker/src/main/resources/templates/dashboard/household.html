<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Household Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/theme.css}">
    <link rel="stylesheet" th:href="@{/css/household.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="navbar nav-bg px-3">
    <span class="navbar-brand text-light">üè† Home Utility Tracker</span>
    <div>
        <a th:href="@{/home}" class="nav-link d-inline-block text-light">Home</a>
        <a th:href="@{/utilities/list}" class="nav-link d-inline-block text-light">Utilities</a>
        <a th:href="@{/reminders}" class="nav-link d-inline-block text-light">Reminders</a>
        <a th:href="@{/goals/list}" class="nav-link d-inline-block text-light">Goals</a>
        <a th:href="@{/appliances/list}" class="nav-link d-inline-block text-light">Service</a>
        <a th:href="@{/logout}" class="nav-link d-inline-block text-light">Logout</a>
    </div>
</nav>

<div class="container-fluid py-4">
    <div class="row">

        <!-- Left Column (65%) -->
        <div class="col-lg-8">
            <!-- Expenses -->
            <div class="card p-3 mb-3">
                <h5>üí∏ Expenses</h5>
                <div class="table-scrollable">
                    <table class="table table-bordered table-sm">
                        <thead>
                            <tr><th>Type</th><th>Amount</th><th>Date</th></tr>
                        </thead>
                        <tbody>
                            <tr th:each="e : ${expenses}">
                                <td th:text="${e.type}">Grocery</td>
                                <td th:text="${e.amount}">1200</td>
                                <td th:text="${e.dueDate}">2025-07-01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Incomes -->
            <div class="card p-3">
                <h5>üí∞ Incomes</h5>
                <div class="table-scrollable">
                    <table class="table table-bordered table-sm">
                        <thead>
                            <tr><th>Type</th><th>Amount</th><th>Date</th></tr>
                        </thead>
                        <tbody>
                            <tr th:each="i : ${incomes}">
                                <td th:text="${i.type}">Salary</td>
                                <td th:text="${i.amount}">30000</td>
                                <td th:text="${i.dueDate}">2025-07-01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Right Column (35%) -->
        <div class="col-lg-4">

            <!-- Reminders (TOP) -->
            <div class="card p-3 mb-3">
                <h5>üîî Reminders</h5>
                <ul class="ps-3 mb-0">
                    <li th:each="r : ${reminders}" th:text="${r}">Pay electricity bill</li>
                </ul>
            </div>

            <!-- Chart -->
            <div class="card p-3 mb-3">
                <h5>üìà Monthly Overview</h5>
                <canvas id="monthlyChart" height="200"></canvas>
            </div>

            <!-- Wallet -->
            <div class="card p-3">
                <h5>üíº Wallet</h5>
                <p>Balance: ‚Çπ<span th:text="${wallet.balance}" style="padding-right: 30%;">0.00</span>
                Monthly Limit: ‚Çπ<span th:text="${wallet.monthlyExpenseLimit}">0.00</span></p>
            </div>

        </div>
    </div>

    <!-- GOAL SECTION (BOTTOM + CENTERED) -->
    <div class="row justify-content-center mt-5">
        <div class="col-md-10">
            <div class="card p-4 text-center">
                <h5>üéØ Goal Progress</h5>
                <div th:each="g : ${goals}" class="mb-3">
                    <p th:text="${g.name}">Buy Laptop</p>
                    <div class="progress">
                        <div class="progress-bar bg-success"
                             th:style="'width:' + (${g.savedAmount} / ${g.targetAmount} * 100) + '%'"
                             th:text="${#numbers.formatDecimal((g.savedAmount / g.targetAmount) * 100, 0, 0)} + '%'">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CHART SCRIPT -->
<script th:inline="javascript">
let chart = new Chart(document.getElementById('monthlyChart'), {
    type: 'bar',
    data: {
        labels: [[${chartLabels}]],
        datasets: [
            {
                label: 'Expenses',
                backgroundColor: '#94618E',
                data: [[${chartExpenses}]]
            },
            {
                label: 'Incomes',
                backgroundColor: '#28a745',
                data: [[${chartIncomes}]]
            }
        ]
    }
});
</script>

</body>
</html>
